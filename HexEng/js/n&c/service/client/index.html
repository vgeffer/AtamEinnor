<!DOCTYPE html>
<html lang="en" onmouseup="mouseUp(event)" ontouchend="touchUp(event)">

	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="N&C Infnity's official site. Play Noughts and Crosses online with infinite virtual paper!">
		<meta name="keywords" content="noughts, crosses, tic tac toe, tic-tac-toe, infinite, infinity, five, 5, online, multiplayer, IHRA">
		<meta name="theme-color" content="#272424"/>
		<title>N&C Infinity</title>
		<!-- <link rel="manifest" href="/manifest.json"> -->
		<!--<link type="text/css" rel="stylesheet" href="css/page.css"/>-->
		<link type="font/ttf" rel="preload" href="/CoveredByYourGrace-Regular.ttf" as="font" crossorigin="anonymous"/>
	</head>

	<body onresize="resize()" scroll="no">		
		<div id="MainMenu" class="flexCol centerScreen" style="align-items: stretch;">
			<div id="menuButtonsRow1" class="flexRow noselect" style="flex-wrap: nowrap; justify-content: space-between;">
				<button class="button margin12Full nowrap" onclick="newGameDisplay()">new game</button>
				<button class="button margin12Full nowrap" onclick="joinGameDisplay()">join game</button>
			</div>

			<div style="border-top: 2px solid #afd245; margin-top: 12px; margin-bottom: 12px;"></div>

			<div id="menuButtonsRow2" class="flexRow noselect" style="flex-wrap: nowrap; justify-content: space-between;">
				<button class="button margin12Full nowrap" onclick="openProfileEditor()">profile editor</button>
				<button class="button margin12Full nowrap" onclick="openPopup($('settings'))">settings</button>
			</div>

			<div id="menuButtonsRow3" class="flexRow noselect" style="flex-wrap: nowrap; justify-content: space-between;">
				<button class="button margin12Full nowrap" onclick="openPopup($('howToPlay'))">how to play</button>
				<button class="button margin12Full nowrap" onclick="openPopup($('about'))">about</button>
			</div>
		</div>

		<div id="overlay" style="background-color: #000000; opacity: 0.6; position: absolute; width: 100%; height: 100%; display: block;"></div>

		<div id="newGame" class="centerScreen popup flexCol inputBig">
			<div class="close" onclick="closePopup(div_newGame); indicator_newGameName.style.display = 'none'; indicator_newGamePlayer.style.display = 'none'"></div>
			
			<span class="text3 noselect underline nowrap">Create a new game</span>

			<input id="newGameName" type="text" maxlength="50" onchange="gameExists(this.value, 'new')" placeholder="" autocomplete="nc_gamename"/>
			<input id="newGamePlayer" type="text" maxlength="20" onchange="playerInfo(this.value, 'new')" placeholder="" autocomplete="nc_otherplayer"/>
			
			<div id="newGameWinCondition" class="flexRow noselect" style="margin-top: 8px; margin-bottom: 8px;">
				<span class="text1 nowrap">game ends at </span>
				<div id="winConditionCycler" class="cycler text1" onclick="cycler(this)">
					<span id="winConditionChoice"></span>
				</div>
			</div>

			<div id="newGamePlayableArea" class="flexRow noselect" style="margin-top: 8px; margin-bottom: 8px;">
				<span class="text1 nowrap">playable area is </span>
				<div id="playableAreaCycler" class="text1 cycler" onclick="cycler(this)">
					<span id="playableAreaChoice"></span>
				</div>
			</div>

			<div class="checkboxContainer flexRow noselect">
				<div id="spectable" class="checkboxUnchecked" onclick="checkbox(this)">
					<div class="checkboxChecked">
						<img class="checkmark">
					</div>
				</div>
				<span class="text1 noselect nowrap checkboxLabel">allow spectating</span>
			</div>

			<div class="checkboxContainer flexRow noselect" style="margin-top: 8px; margin-bottom: 8px;">
				<div id="sendInvite" class="checkboxUnchecked" onclick="checkbox(this)">
					<div class="checkboxChecked">
						<img class="checkmark">
					</div>
				</div>
				<span class="text1 noselect nowrap checkboxLabel">send invite</span>
			</div>

			<button id="buttonCreateGame" class="button noselect" onclick="createGame()">create</button>
		</div>

		<div id="joinGame" class="centerScreen popup flexCol inputBig">
			<span class="text3 noselect underline nowrap">Join an existing game</span>
			<div class="close" onclick="closePopup(div_joinGame); indicator_joinGameName.style.display = 'none'"></div>
			<input id="joinGameName" type="text" maxlength="50" onchange="gameExists(this.value, 'join')" placeholder="" autocomplete="nc_gamename"/>
			<button id="buttonJoinGame" class="button noselect" onclick="join(input_joinGameName.value)">join</button>
		</div>

		<div id="authBox" class="centerScreen inputBig" style="display: none">
			<div id="loginBox" class="flexCol">
				<input id="loguname" type="text" maxlength="20" placeholder="username" autocomplete="username"/>
				<div class="passwordWrapper" style="margin-top: 0px;">
					<input id="logpassw" type="password" placeholder="password" autocomplete="current-password"/>
					<img class="eye"></img>
				</div>
				

				<div class="checkboxContainer flexRow noselect">
					<div id="logAutologin" class="checkboxUnchecked" onclick="checkbox(this)">
						<div class="checkboxChecked">
							<img class="checkmark">
						</div>
					</div>
					<span class="text1 noselect nowrap checkboxLabel">enable autologin</span>
				</div>

				<button id="buttonLogin" class="button noselect" onclick="LoginUser(loginUsername.value, loginPassword.value, checkbox_loginAutologin.checked)">login</button>
				
				<button id="buttonSwapToRegister" class="button noselect text0" onclick="$('loginBox').style.display = 'none'; $('registerBox').style.display = 'flex';">don't have an account? register!</button>
			</div>

			<div id="registerBox" class="flexCol" style="display: none;">
				<input id="reguname" type="text" maxlength="20" placeholder="username" autocomplete="username"/>
				<input id="regemail" type="text" maxlength="80" placeholder="email (optional)" autocomplete="email"/>
				<div class="passwordWrapper" style="margin-top: 0px;">
					<input id="regpassw" type="password" placeholder="password" autocomplete="new-password"/>
					<img class="eye"></img>
				</div>
				
				
				<div class="checkboxContainer flexRow noselect">
					<div id="regAutologin" class="checkboxUnchecked" onclick="checkbox(this)">
						<div class="checkboxChecked">
							<img class="checkmark">
						</div>
					</div>
					<span class="text1 noselect nowrap checkboxLabel">enable autologin</span>
				</div>

				<button id="buttonRegister" class="button noselect" onclick="RegisterNewUser(registerUsername.value, registerPassword.value, registerEmail.value, checkbox_registerAutologin.checked)">register</button>
				
				<button id="buttonSwapToLogin" class="button noselect text0" onclick="$('registerBox').style.display = 'none'; $('loginBox').style.display = 'flex';">already have an account? login!</button>
			</div>
			
		</div>

		<div id="gamediv" class="flexCol noselect" style="display: none;">
			<div id="gameInfoDiv" class="flexRow" style="margin-left: 12px; width: calc(100vw - 24px);">
				<div id="p0_info" class="flexCol" style="align-items: flex-start;">
					<div id="p0_turnIndicator"></div>
					<img id="p0_photo" onclick="displayProfileByID(players[0])">
					<span id="p0_name" class="text2">placeholder p0_name</span>
					<span id="p0_points" class="text1">placeholder p0_points</span>
				</div>

				<div id="gameControlsContainer" class="flexCol">
					<div id="gameControls" class="flexCol">
						<span id="game_name" class="text2">game_name</span>
						<span id="game_winCondition" class="text1">win_condition</span>
						<span id="coordinates" class="text1">x: ?  y: ?</span>
						<button class="button noselect text1" onclick="jumpToLastMove()">jump to last move</button>
						<button class="button noselect text1" onclick="exitGame()">exit game</button>
					</div>
				</div>
				
				<div id="p1_info" class="flexCol" style="align-items: flex-end;">
					<div id="p1_turnIndicator"></div>
					<img id="p1_photo" onclick="displayProfileByID(players[1])">
					<span id="p1_name" class="text2">placeholder p1_name</span>
					<span id="p1_points" class="text1">placeholder p1_points</span>
				</div>
			</div>
			<canvas id="mainCanvas" class="text4" onmousedown="mouseDown(event)" ontouchstart="touchDown(event)" onwheel="zoom(event)" style="display: block; border: 1px solid #ffffff; padding: 0px; margin-left: 8px; background-color: #272424;">
				Your browser does not support the HTML5 canvas tag. This game requires it to be able to render the playfield. Recommended is everything that is not Internet Explorer or an older version of Microsoft Edge (not considering discontinued browsers nobody uses from 10+ years ago).
			</canvas>
		</div>

		<div id="spectatorAlert" class="text1 sandwichLike noselect">
			<span id="spectatorText" class="nowrap">spectator mode</span>
		</div>

		<div id="profileViewer" class="centerScreen popup flexCol inputBig" style="display: none;">
			<div class="close" onclick="closePopup(profileViewer)"></div>
			<span id="profileUsername" class="text4 underline nowrap" style="margin-bottom: 8px;">username</span>
			<div id="profileTop" class="flexRow">
				<img id="profilePhoto">
				<div id="profileRight" class="flexCol" style="margin-left: 8px;">
					<span id="profilePoints" class="text2 margin8 nowrap">total points:</span>
					<span id="profileLastSeen" class="text2 margin8 nowrap">last seen </span>
					<span id="profileRegistered" class="text2 margin8 nowrap">registered on </span>
				</div>
			</div>
		</div>

		<div id="profileEditor" class="centerScreen popup flexCol inputBig" style="display: none;">
			<div class="close" onclick="closePopup(profileEditor)"></div>
			<span id="profileEditorUsername" class="text4 underline nowrap" style="margin-bottom: 8px;">username</span>
			<div id="profileEditorTop" class="flexRow" style="margin-bottom: 10px;">
				<img id="profileEditorPhoto">
				<div id="profileEditorRight" class="flexCol" style="margin-left: 8px;">
					<span id="profileEditorPoints" class="text2 margin8 nowrap">total points:</span>
					<span id="profileEditorRegistered" class="text2 margin8 nowrap">registered on </span>
				</div>
			</div>

			<span class="text2 margin8 underline">choose your profile photo</span>

			<div id="photoSetter" class="flexRow" style="margin-bottom: 16px;">
				<div id="photoChoices" class="flexCol" style="margin-right: 12px;">
					<div id="photoChoicesRow1" class="flexRow">
						<img id="boy1" class="photoChoice" onclick="choosePhoto(this.id)">
						<img id="boy2" class="photoChoice" onclick="choosePhoto(this.id)">
						<img id="boy3" class="photoChoice" onclick="choosePhoto(this.id)">
					</div>
					
					<div id="photoChoicesRow2" class="flexRow">
						<img id="girl1" class="photoChoice" onclick="choosePhoto(this.id)">
						<img id="girl2" class="photoChoice" onclick="choosePhoto(this.id)">
						<img id="girl3" class="photoChoice" onclick="choosePhoto(this.id)">
					</div>
				</div>

				<div id="photoUpload" class="flexCol" style="align-items: flex-start; max-width: 4cm;">
					<label for="fileUpload" class="text1 custom-file-upload">or upload your own one! (click here)</label>
					<input type="file" id="fileUpload" accept="image/png, image/jpeg, image/bmp, image/tiff" class="text-1" onchange="uploadPhoto()">
				</div>
			</div>
			
			<span class="text2 margin8 underline">and your profile color</span>

			<div id="divColorPicker" class="flexRow" style="width: 100%;">
				<div id="colorPicker" class="cp-default flexRow"></div>
				<div id="colorManual" class="flexCol inputBig">
					<input id="colorManualHex" type="text" style="width: 3.5cm; max-width: 80%;" maxlength="7" onchange="colorPicker.setHex(this.value);">
					<button id="submitColor" class="button" onclick="setColor()">save color</button>
				</div>
			</div>
		</div>

		<div id="settings" class="popup centerScreen flexCol" style="display: none; width: 13cm;">
			<div class="close" onclick="closePopup($('settings'))"></div>

			<span class="text4 margin8 underline">settings</span>

			<div class="flexCol" style="align-items: flex-start;">
				<span class="text3 margin8 underline">account</span>
				
				<div class="flexCol settingsFeatures inputBig">
					<span class="text2 underline">change password</span>
					<div class="flexCol">
						<div class="passwordWrapper">
							<input id="changePassCurrent" type="password" placeholder="old password" autocomplete="current-password" style="margin-top: 0px; margin-bottom: 16px;">
							<img class="eye"></img>
						</div>
						<div class="passwordWrapper">
							<input id="changePassNew" type="password" placeholder="new password" autocomplete="new-password" style="margin-top: 0px; margin-bottom: 8px;">
							<img class="eye"></img>
						</div>
						<button id="confirmPassChange" class="button noselect" onclick="changePassword($('changePassCurrent').value, $('changePassNew').value)">confirm</button>
					</div>
				</div>

				<div class="flexCol settingsFeatures settingsFeaturesHover" onclick="logOutEverywhere()">
					<span class="text2 underline">log out everywhere</span>
					<span class="text1">disables autologin on every device by changing your refresh token and logs you out on this device</span>
				</div>

				<div class="flexCol settingsFeatures settingsFeaturesHover" onclick="logOut()">
					<span class="text2 underline">log out</span>
					<span class="text1">logs you out and disables autologin on this device</span>
				</div>
			</div>
				
		</div>

		<div id="loading" class="popup centerScreen flexCol">
			<span id="spanTitle" class="text4 margin8 nowrap">N&C Infinity</span>
			<div id="progressBarContainer" class="margin8" style="width: 12cm; height: 40px; border: 3px solid #afd245; border-radius: 12px;">
				<div id="progressBar" style="background-color: #fcac34; width: 0%; height: 100%; border-radius: 10px; transition: 150ms;"></div>
			</div>
			<span id="spanLoading" class="text3 margin8 nowrap">loading game... 0.00%</span>
		</div>

		<div id="sandwich" class="text1 sandwichLike noselect">
			<div id="loader"></div>
			<span id="sandwichText" class="nowrap">logging in...</span>
		</div>

		<div id="winAnnouncer" class="flexCol" style="display: none;">
			<span class="text3">game over!</span>
			<img id="crown" class="noselect" style="max-width: 10cm;">
			<span id="winner" class="text3"></span>
		</div>

		<div id="invite" class="popup flexCol centerScreen" style="display: none;">
			<div class="close" onclick="closePopup($('invite'))"></div>
			<span id="inviteText" class="text3" style="text-align: center;"></span>
			<div class="flexRow" style="flex-wrap: nowrap;">
				<button class="button noselect" onclick="acceptInvite()">accept</button>
				<button class="button noselect" onclick="rejectInvite()">reject</button>
				<button class="button noselect" onclick="blockInvite()">block</button>
			</div>
		</div>

		<div id="error" class="popup flexCol centerScreen" style="display: none; box-shadow: 0 0 12px 8px #ff404080; border: 3px solid #ff4040; z-index: 3;">
			<div id="errorClose" class="close" onclick="closePopup($('error'))"></div>
			<span class="text3 margin8" style="text-align: center;">oops, an error has occured</span>
			<span id="errorDesc" class="text2 margin8" style="text-align: center;"></span>
			<button id="errorButton" class="button noselect"></button>
		</div>

		<div id="connectionLost" class="popup flexCol centerScreen" style="display: none; box-shadow: 0 0 12px 8px #ff404080; border: 3px solid #ff4040;">
			<span class="text3 margin8" style="text-align: center;">connection lost</span>
			<span class="text1" style="text-align: center;">connection to The Server was lost</span>
			<span class="text1" style="text-align: center;">please, check your internet connection</span>
			<span class="text1" style="text-align: center;">if your internet is alright, The Server may have crashed or you logged in elsewhere</span>
			<button class="button noselect" onclick="location.reload()">restart game</button>
		</div>

		<div id="howToPlay" class="popup flexCol centerScreen" style="display: none; width: max-content;">
			<div class="close" onclick="closePopup($('howToPlay'))"></div>
			<span class="text4" style="text-decoration: underline;">How to play?</span><br>
			
			<div style="width: 100%; align-items: flex-start;">
				<span class="text3">TL;DR: Very big Tic-Tac-Toe, 5 win, not 3</span><br><br>
				<span class="text2">Overview</span><br>
				<span class="text1">N&C Infinity is an online version of what Noughts and Crosses (or its smaller, boring alternative Tic-Tac-Toe) should be. Normally players are limited to what size their paper offers. This game offers infinite playfield without the need to use any paper.</span><br>
				<span class="text1">Also, you may compare this game to Gomoku, which is very similar, but has a different start to compensate for first player advantage and ends when a player scores first time with exactly 5, no more pieces in a line.</span><br>
				<span class="text1">The game starts when you create a game by clicking the create game button, filling in all The Server needs to know and then goes on forever. Unless you set a point at which a player wins by scoring a chosen count of points. If you want to add the old paper feeling, you can also limit the size of the playfield. Then you choose if you want other players to be able to spectate your game live and if you want to send an immediate invite for the player you are playing with.</span><br>
				<span class="text1">Remember the name of your game, because you can at any moment join back and keep on playing.</span><br><br>
				<span class="text2">The game starts</span><br>
				<span class="text1">First goes the second player. Sounds logical. You created the game, you invited the other player and a guest is always first, right? You draw your nought or cross by clicking the field you want it to be at. Last move made is highlighted with an orange background and is 'jumpable' to using the button above the playfield. This way it's fair if someone makes a move off your screen.</span><br>
				<span class="text1">The turn swaps to the other player once made and if you want to know who's turn it is, just look at the colorful glow behind their photo. And yes, you can change your color to your favourite one in the profile editor.</span><br><br>
				<span class="text2">And goes on</span><br>
				<span class="text1">A player scores once they align 5 of their pieces in a straight line - horizontally, vertically or diagonally. You can also score using already crossed out pieces, but you can cross them only once in each direction. 6 in a row don't count as 2 points. If the game was not set to be neverending, it ends once one of the players achieves the desired amount of points.</span><br><br>
				<span class="text2">Some technical stuff</span><br>
				<span class="text1">If 6 or more uncrossed pieces in a line are uncrossed, the group of five most to the left is preferred by The Server. When aligned vertically, the highest one is chosen and crossed.</span><br>
				<span class="text1">If The Server and a client desynchronize, an error is raised on the client and it also has to leave the game as further play is not possible. User can rejoin the game right away. If something goes horribly wrong, The Server holds the authoritative copy of the game and no invalid moves will ever be confirmed (unless something breaks).</span><br>
				<span class="text1">Autosave is set to 60 seconds long intervals.</span><br><br>
				<span class="text3">Good luck and have fun!</span>
			</div>
			<button class="button" onclick="closePopup($('howToPlay'))">close</button>
		</div>

		<div id="about" class="popup flexCol centerScreen" style="display: none; width: max-content;">
			<div class="close" onclick="closePopup($('about'))"></div>
			<span class="text4" style="text-decoration: underline;">About</span>
			<br>
			<span class="text3 nowrap">Coded by <strong>Matej &#34;Kotol&#34;</strong></span>
			<span class="text3 nowrap">Designed by <strong>Anna</strong></span>
			<br><br>
			<span class="text2">The Great Server resides on a <strong>Raspberry Pi 4 Model B</strong></span>
			<span class="text2">Get your own one on <strong><a href="https://raspberrypi.org/" target="_blank" style="color: #afd245;">raspberrypi.org</a></strong></span>
			<br>
			<span class="text2">Free Dynamic DNS provided by <strong><a href="https://freedns.afraid.org/" target="_blank" style="color: #afd245;">freedns.afraid.org</a></strong></span>
			<br>
			<span class="text2">Taken part in <strong><a href="https://ics.upjs.sk/ihra/" target="_blank" style="color: #afd245;">IHRA 2020</a></strong> game competition <strong><a href="https://ics.upjs.sk/ihra/pages/results.html" target="_blank" style="color: #afd245">(we won!)</a></strong></span>
			<img id="aboutUPJS" style="max-width: 4cm;">
		</div>

		<div id="indicatorNewGameName" class="indicator"></div>
		<div id="indicatorNewGamePlayer" class="indicator"></div>
		<div id="indicatorJoinGameName" class="indicator"></div>
		
		<span id="dummy1" class="text1" style="position: absolute; left: -9999px; top: -9999px">if you see this it is an error, report please</span>
		<span id="dummy2" class="text2" style="position: absolute; left: -9999px; top: -9999px">if you see this it is an error, report please</span>
		<div class="inputBig">
			<input type="text" id="dummyInput" style="position: absolute; left: -9999px; top: -9999px">
		</div>

		<script src="js/colorpicker.min.js"></script>
		<script src="js/page.js"></script>
	</body>
</html>
